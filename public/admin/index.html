<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Content Manager</title>
    <style>
      #loader {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      }
      .error-message {
        color: #e53e3e;
        padding: 20px;
        border: 1px solid #feb2b2;
        border-radius: 4px;
        background-color: #fff5f5;
        margin: 20px;
      }
    </style>
  </head>
  <body>
    <!-- Create a dedicated mount point for CMS -->
    <div id="cms-root">
      <div id="loader">Loading Content Management System...</div>
    </div>

    <script>
      // Initialize CMS after DOM is fully loaded
      function initCMS() {
        const loader = document.getElementById('loader');

        try {
          window.CMS.init({
            config: {
              load_config_file: true,
              backend: {
                name: 'github',
                repo: 'RishiCo-Canna/RishiStaticNEXTsite',
                branch: 'main',
                auth_scope: 'repo',
                base_url: window.location.origin,
                auth_endpoint: '/api/auth'
              }
            }
          }).then(() => {
            if (loader) {
              loader.style.display = 'none';
            }
          }).catch(error => {
            console.error('CMS initialization error:', error);
            if (loader) {
              loader.innerHTML = `
                <div class="error-message">
                  <h2>Failed to initialize CMS</h2>
                  <p>${error.message}</p>
                  <p>Please check the console for more details.</p>
                </div>
              `;
            }
          });
        } catch (error) {
          console.error('Failed to initialize CMS:', error);
          if (loader) {
            loader.innerHTML = `
              <div class="error-message">
                <h2>Failed to initialize CMS</h2>
                <p>${error.message}</p>
                <p>Please check the console for more details.</p>
              </div>
            `;
          }
        }
      }

      // Load CMS script and initialize
      function loadCMS() {
        const script = document.createElement('script');
        script.src = 'https://unpkg.com/decap-cms@3.4.0/dist/decap-cms.js';
        script.onload = () => {
          // Wait for CMS to be available
          const checkCMS = setInterval(() => {
            if (window.CMS) {
              clearInterval(checkCMS);
              initCMS();
            }
          }, 100);
        };
        script.onerror = () => {
          document.getElementById('loader').innerHTML = '<div class="error-message">Failed to load CMS script</div>';
        };
        document.body.appendChild(script);
      }

      // Start loading when DOM is ready
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', loadCMS);
      } else {
        loadCMS();
      }
    </script>
  </body>
</html>